################################################################################
@cms_body[]
# Если передаётся путь к картинке
^if(def $form:image){
# Инициализируем пути к фотке
 $srcpath[/images/${textext.className}/src/${form:idpage}/${form:image}]
 $bigpath[/images/${textext.className}/big/${form:idpage}/${form:image}]
 $smallpath[/images/${textext.className}/small/${form:idpage}/${form:image}]
# Удаляем фотку
 $res[^file:delete[$srcpath;$.exception(false)]]
 $res[^file:delete[$bigpath;$.exception(false)]]
 $res[^file:delete[$smallpath;$.exception(false)]]
# Переходим к галерее 
 $response:refresh[
  $.value(0)
  $.url[materials.html?idpage=$form:idpage&idpage_name=$form:idpage_name&width=$width]
 ]
# Иначе выводим ошибку 
}{
 ^insert_error_fields[]
}
################################################################################